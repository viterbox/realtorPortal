require 'rails_helper'
require 'trovit_updater_service'

RSpec.describe TrovitUpdaterService do
    context "setup" do
        before do
            @service = TrovitUpdaterService.new
            @xmlDocWithAdNodes = Nokogiri::XML("<trovit><ad><property_type><![CDATA[Casa]]></property_type><id><![CDATA[1483s]]></id><url><![CDATA[https://www.stagingeb.com/mx/inmueble/1483-casa-en-cuauhtemoc-hipodromo-condesa?utm_source=Trovit]]></url><title><![CDATA[Custom Property Type]]></title><content><![CDATA[EasyBroker ID: 1483. Casa en México, Cuauhtemoc, Hipódromo Condesa. Custom Property Type]]></content><type><![CDATA[For sale]]></type><agency><![CDATA[Real Estate Rockstars]]></agency><price currency='USD'><![CDATA[5990000.0]]></price><floor_area unit='meters'><![CDATA[3]]></floor_area><rooms><![CDATA[2]]></rooms><bathrooms><![CDATA[1]]></bathrooms><city><![CDATA[Cuauhtémoc]]></city><city_area><![CDATA[Hipódromo Condesa]]></city_area><region><![CDATA[Ciudad de México]]></region><longitude><![CDATA[-99.1495107]]></longitude><latitude><![CDATA[19.4356338]]></latitude><pictures><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1483/2969/living.jpg]]></picture_url></picture><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1483/2971/patio.jpg]]></picture_url></picture><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1483/2967/kitchen.jpg]]></picture_url></picture></pictures><date><![CDATA[02/02/2017]]></date><time><![CDATA[22:13]]></time></ad><ad><property_type><![CDATA[Casa]]></property_type><id><![CDATA[1483r]]></id><url><![CDATA[https://www.stagingeb.com/mx/inmueble/1483-casa-en-cuauhtemoc-hipodromo-condesa?utm_source=Trovit]]></url><title><![CDATA[Custom Property Type]]></title><content><![CDATA[EasyBroker ID: 1483. Casa en México, Cuauhtemoc, Hipódromo Condesa. Custom Property Type]]></content><type><![CDATA[For rent]]></type><agency><![CDATA[Real Estate Rockstars]]></agency><price currency='USD'><![CDATA[20000.0]]></price><floor_area unit='meters'><![CDATA[3]]></floor_area><rooms><![CDATA[2]]></rooms><bathrooms><![CDATA[1]]></bathrooms><city><![CDATA[Cuauhtémoc]]></city><city_area><![CDATA[Hipódromo Condesa]]></city_area><region><![CDATA[Ciudad de México]]></region><longitude><![CDATA[-99.1495107]]></longitude><latitude><![CDATA[19.4356338]]></latitude><pictures><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1483/2969/living.jpg]]></picture_url></picture><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1483/2971/patio.jpg]]></picture_url></picture><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1483/2967/kitchen.jpg]]></picture_url></picture></pictures><date><![CDATA[02/02/2017]]></date><time><![CDATA[22:13]]></time></ad><ad><property_type><![CDATA[Departamento]]></property_type><id><![CDATA[1486s]]></id><url><![CDATA[https://www.stagingeb.com/mx/inmueble/1486-departamento-en-cuauhtemoc-condesa?utm_source=Trovit]]></url><title><![CDATA[Departamento con Aloja 4, 1 baño en Condesa, Cuauhtémoc, Ciudad de México, México]]></title><content><![CDATA[EasyBroker ID: 1486. Departamento en México, Cuauhtemoc, Condesa. It's a long term l.]]></content><type><![CDATA[For sale]]></type><agency><![CDATA[Real Estate Rockstars]]></agency><price currency='MXN'><![CDATA[5000000.0]]></price><floor_area unit='meters'><![CDATA[3]]></floor_area><plot_area unit='meters'><![CDATA[40000]]></plot_area><bathrooms><![CDATA[1]]></bathrooms><city><![CDATA[Cuauhtémoc]]></city><city_area><![CDATA[Condesa]]></city_area><region><![CDATA[Ciudad de México]]></region><longitude><![CDATA[-99.1840123]]></longitude><latitude><![CDATA[19.3875393]]></latitude><address><![CDATA[Jump Street]]></address><pictures><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1486/4901/1486.jpg?1444841730]]></picture_url></picture><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1486/4903/1486.jpg?1444841730]]></picture_url></picture><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1486/4905/1486.jpg?1444841730]]></picture_url></picture></pictures><date><![CDATA[02/02/2017]]></date><time><![CDATA[22:13]]></time></ad><ad><property_type><![CDATA[Departamento]]></property_type><id><![CDATA[1486r]]></id><url><![CDATA[https://www.stagingeb.com/mx/inmueble/1486-departamento-en-cuauhtemoc-condesa?utm_source=Trovit]]></url><title><![CDATA[Departamento con Aloja 4, 1 baño en Condesa, Cuauhtémoc, Ciudad de México, México]]></title><content><![CDATA[EasyBroker ID: 1486. Departamento en México, Cuauhtemoc, Condesa. It's a long term l.]]></content><type><![CDATA[For rent]]></type><agency><![CDATA[Real Estate Rockstars]]></agency><price currency='MXN'><![CDATA[5000.0]]></price><floor_area unit='meters'><![CDATA[3]]></floor_area><plot_area unit='meters'><![CDATA[40000]]></plot_area><bathrooms><![CDATA[1]]></bathrooms><city><![CDATA[Cuauhtémoc]]></city><city_area><![CDATA[Condesa]]></city_area><region><![CDATA[Ciudad de México]]></region><longitude><![CDATA[-99.1840123]]></longitude><latitude><![CDATA[19.3875393]]></latitude><address><![CDATA[Jump Street]]></address><pictures><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1486/4901/1486.jpg?1444841730]]></picture_url></picture><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1486/4903/1486.jpg?1444841730]]></picture_url></picture><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1486/4905/1486.jpg?1444841730]]></picture_url></picture></pictures><date><![CDATA[02/02/2017]]></date><time><![CDATA[22:13]]></time></ad><ad><property_type><![CDATA[Departamento]]></property_type><id><![CDATA[1486t]]></id><url><![CDATA[https://www.stagingeb.com/mx/inmueble/1486-departamento-en-cuauhtemoc-condesa?utm_source=Trovit]]></url><title><![CDATA[Departamento con Aloja 4, 1 baño en Condesa, Cuauhtémoc, Ciudad de México, México]]></title><content><![CDATA[EasyBroker ID: 1486. Departamento en México, Cuauhtemoc, Condesa. It's a long term l.]]></content><type><![CDATA[Short term rentals]]></type><agency><![CDATA[Real Estate Rockstars]]></agency><price currency='MXN' period='monthly'><![CDATA[1500]]></price><floor_area unit='meters'><![CDATA[3]]></floor_area><plot_area unit='meters'><![CDATA[40000]]></plot_area><bathrooms><![CDATA[1]]></bathrooms><city><![CDATA[Cuauhtémoc]]></city><city_area><![CDATA[Condesa]]></city_area><region><![CDATA[Ciudad de México]]></region><longitude><![CDATA[-99.1840123]]></longitude><latitude><![CDATA[19.3875393]]></latitude><address><![CDATA[Jump Street]]></address><pictures><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1486/4901/1486.jpg?1444841730]]></picture_url></picture><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1486/4903/1486.jpg?1444841730]]></picture_url></picture><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1486/4905/1486.jpg?1444841730]]></picture_url></picture></pictures><date><![CDATA[02/02/2017]]></date><time><![CDATA[22:13]]></time></ad></trovit>")
            @xmlDocWihtAdNodeWithFirsNodeWithoutPicturesAndAttributes =  Nokogiri::XML("<trovit><ad><property_type><![CDATA[Casa]]></property_type><id><![CDATA[1483s]]></id><url><![CDATA[https://www.stagingeb.com/mx/inmueble/1483-casa-en-cuauhtemoc-hipodromo-condesa?utm_source=Trovit]]></url><title><![CDATA[Custom Property Type]]></title><content><![CDATA[EasyBroker ID: 1483. Casa en México, Cuauhtemoc, Hipódromo Condesa. Custom Property Type]]></content><type><![CDATA[For sale]]></type><agency><![CDATA[Real Estate Rockstars]]></agency><price currency='USD'><![CDATA[5990000.0]]></price><city><![CDATA[Cuauhtémoc]]></city><city_area><![CDATA[Hipódromo Condesa]]></city_area><region><![CDATA[Ciudad de México]]></region><longitude><![CDATA[-99.1495107]]></longitude><latitude><![CDATA[19.4356338]]></latitude><date><![CDATA[02/02/2017]]></date><time><![CDATA[22:13]]></time></ad><ad><property_type><![CDATA[Casa]]></property_type><id><![CDATA[1483r]]></id><url><![CDATA[https://www.stagingeb.com/mx/inmueble/1483-casa-en-cuauhtemoc-hipodromo-condesa?utm_source=Trovit]]></url><title><![CDATA[Custom Property Type]]></title><content><![CDATA[EasyBroker ID: 1483. Casa en México, Cuauhtemoc, Hipódromo Condesa. Custom Property Type]]></content><type><![CDATA[For rent]]></type><agency><![CDATA[Real Estate Rockstars]]></agency><price currency='USD'><![CDATA[20000.0]]></price><floor_area unit='meters'><![CDATA[3]]></floor_area><rooms><![CDATA[2]]></rooms><bathrooms><![CDATA[1]]></bathrooms><city><![CDATA[Cuauhtémoc]]></city><city_area><![CDATA[Hipódromo Condesa]]></city_area><region><![CDATA[Ciudad de México]]></region><longitude><![CDATA[-99.1495107]]></longitude><latitude><![CDATA[19.4356338]]></latitude><pictures><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1483/2969/living.jpg]]></picture_url></picture><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1483/2971/patio.jpg]]></picture_url></picture><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1483/2967/kitchen.jpg]]></picture_url></picture></pictures><date><![CDATA[02/02/2017]]></date><time><![CDATA[22:13]]></time></ad><ad><property_type><![CDATA[Departamento]]></property_type><id><![CDATA[1486s]]></id><url><![CDATA[https://www.stagingeb.com/mx/inmueble/1486-departamento-en-cuauhtemoc-condesa?utm_source=Trovit]]></url><title><![CDATA[Departamento con Aloja 4, 1 baño en Condesa, Cuauhtémoc, Ciudad de México, México]]></title><content><![CDATA[EasyBroker ID: 1486. Departamento en México, Cuauhtemoc, Condesa. It's a long term l.]]></content><type><![CDATA[For sale]]></type><agency><![CDATA[Real Estate Rockstars]]></agency><price currency='MXN'><![CDATA[5000000.0]]></price><floor_area unit='meters'><![CDATA[3]]></floor_area><plot_area unit='meters'><![CDATA[40000]]></plot_area><bathrooms><![CDATA[1]]></bathrooms><city><![CDATA[Cuauhtémoc]]></city><city_area><![CDATA[Condesa]]></city_area><region><![CDATA[Ciudad de México]]></region><longitude><![CDATA[-99.1840123]]></longitude><latitude><![CDATA[19.3875393]]></latitude><address><![CDATA[Jump Street]]></address><pictures><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1486/4901/1486.jpg?1444841730]]></picture_url></picture><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1486/4903/1486.jpg?1444841730]]></picture_url></picture><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1486/4905/1486.jpg?1444841730]]></picture_url></picture></pictures><date><![CDATA[02/02/2017]]></date><time><![CDATA[22:13]]></time></ad><ad><property_type><![CDATA[Departamento]]></property_type><id><![CDATA[1486r]]></id><url><![CDATA[https://www.stagingeb.com/mx/inmueble/1486-departamento-en-cuauhtemoc-condesa?utm_source=Trovit]]></url><title><![CDATA[Departamento con Aloja 4, 1 baño en Condesa, Cuauhtémoc, Ciudad de México, México]]></title><content><![CDATA[EasyBroker ID: 1486. Departamento en México, Cuauhtemoc, Condesa. It's a long term l.]]></content><type><![CDATA[For rent]]></type><agency><![CDATA[Real Estate Rockstars]]></agency><price currency='MXN'><![CDATA[5000.0]]></price><floor_area unit='meters'><![CDATA[3]]></floor_area><plot_area unit='meters'><![CDATA[40000]]></plot_area><bathrooms><![CDATA[1]]></bathrooms><city><![CDATA[Cuauhtémoc]]></city><city_area><![CDATA[Condesa]]></city_area><region><![CDATA[Ciudad de México]]></region><longitude><![CDATA[-99.1840123]]></longitude><latitude><![CDATA[19.3875393]]></latitude><address><![CDATA[Jump Street]]></address><pictures><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1486/4901/1486.jpg?1444841730]]></picture_url></picture><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1486/4903/1486.jpg?1444841730]]></picture_url></picture><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1486/4905/1486.jpg?1444841730]]></picture_url></picture></pictures><date><![CDATA[02/02/2017]]></date><time><![CDATA[22:13]]></time></ad><ad><property_type><![CDATA[Departamento]]></property_type><id><![CDATA[1486t]]></id><url><![CDATA[https://www.stagingeb.com/mx/inmueble/1486-departamento-en-cuauhtemoc-condesa?utm_source=Trovit]]></url><title><![CDATA[Departamento con Aloja 4, 1 baño en Condesa, Cuauhtémoc, Ciudad de México, México]]></title><content><![CDATA[EasyBroker ID: 1486. Departamento en México, Cuauhtemoc, Condesa. It's a long term l.]]></content><type><![CDATA[Short term rentals]]></type><agency><![CDATA[Real Estate Rockstars]]></agency><price currency='MXN' period='monthly'><![CDATA[1500]]></price><floor_area unit='meters'><![CDATA[3]]></floor_area><plot_area unit='meters'><![CDATA[40000]]></plot_area><bathrooms><![CDATA[1]]></bathrooms><city><![CDATA[Cuauhtémoc]]></city><city_area><![CDATA[Condesa]]></city_area><region><![CDATA[Ciudad de México]]></region><longitude><![CDATA[-99.1840123]]></longitude><latitude><![CDATA[19.3875393]]></latitude><address><![CDATA[Jump Street]]></address><pictures><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1486/4901/1486.jpg?1444841730]]></picture_url></picture><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1486/4903/1486.jpg?1444841730]]></picture_url></picture><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1486/4905/1486.jpg?1444841730]]></picture_url></picture></pictures><date><![CDATA[02/02/2017]]></date><time><![CDATA[22:13]]></time></ad></trovit>")
            @xmlDocWithoutAdNodes = Nokogiri::XML("<trovit><post><property_type><![CDATA[Casa]]></property_type><id><![CDATA[1483s]]></id><url><![CDATA[https://www.stagingeb.com/mx/inmueble/1483-casa-en-cuauhtemoc-hipodromo-condesa?utm_source=Trovit]]></url><title><![CDATA[Custom Property Type]]></title><content><![CDATA[EasyBroker ID: 1483. Casa en México, Cuauhtemoc, Hipódromo Condesa. Custom Property Type]]></content><type><![CDATA[For sale]]></type><agency><![CDATA[Real Estate Rockstars]]></agency><price currency='USD'><![CDATA[5990000.0]]></price><floor_area unit='meters'><![CDATA[3]]></floor_area><rooms><![CDATA[2]]></rooms><bathrooms><![CDATA[1]]></bathrooms><city><![CDATA[Cuauhtémoc]]></city><city_area><![CDATA[Hipódromo Condesa]]></city_area><region><![CDATA[Ciudad de México]]></region><longitude><![CDATA[-99.1495107]]></longitude><latitude><![CDATA[19.4356338]]></latitude><pictures><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1483/2969/living.jpg]]></picture_url></picture><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1483/2971/patio.jpg]]></picture_url></picture><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1483/2967/kitchen.jpg]]></picture_url></picture></pictures><date><![CDATA[02/02/2017]]></date><time><![CDATA[22:13]]></time></post><post><property_type><![CDATA[Casa]]></property_type><id><![CDATA[1483r]]></id><url><![CDATA[https://www.stagingeb.com/mx/inmueble/1483-casa-en-cuauhtemoc-hipodromo-condesa?utm_source=Trovit]]></url><title><![CDATA[Custom Property Type]]></title><content><![CDATA[EasyBroker ID: 1483. Casa en México, Cuauhtemoc, Hipódromo Condesa. Custom Property Type]]></content><type><![CDATA[For rent]]></type><agency><![CDATA[Real Estate Rockstars]]></agency><price currency='USD'><![CDATA[20000.0]]></price><floor_area unit='meters'><![CDATA[3]]></floor_area><rooms><![CDATA[2]]></rooms><bathrooms><![CDATA[1]]></bathrooms><city><![CDATA[Cuauhtémoc]]></city><city_area><![CDATA[Hipódromo Condesa]]></city_area><region><![CDATA[Ciudad de México]]></region><longitude><![CDATA[-99.1495107]]></longitude><latitude><![CDATA[19.4356338]]></latitude><pictures><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1483/2969/living.jpg]]></picture_url></picture><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1483/2971/patio.jpg]]></picture_url></picture><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1483/2967/kitchen.jpg]]></picture_url></picture></pictures><date><![CDATA[02/02/2017]]></date><time><![CDATA[22:13]]></time></post><post><property_type><![CDATA[Departamento]]></property_type><id><![CDATA[1486s]]></id><url><![CDATA[https://www.stagingeb.com/mx/inmueble/1486-departamento-en-cuauhtemoc-condesa?utm_source=Trovit]]></url><title><![CDATA[Departamento con Aloja 4, 1 baño en Condesa, Cuauhtémoc, Ciudad de México, México]]></title><content><![CDATA[EasyBroker ID: 1486. Departamento en México, Cuauhtemoc, Condesa. It's a long term l.]]></content><type><![CDATA[For sale]]></type><agency><![CDATA[Real Estate Rockstars]]></agency><price currency='MXN'><![CDATA[5000000.0]]></price><floor_area unit='meters'><![CDATA[3]]></floor_area><plot_area unit='meters'><![CDATA[40000]]></plot_area><bathrooms><![CDATA[1]]></bathrooms><city><![CDATA[Cuauhtémoc]]></city><city_area><![CDATA[Condesa]]></city_area><region><![CDATA[Ciudad de México]]></region><longitude><![CDATA[-99.1840123]]></longitude><latitude><![CDATA[19.3875393]]></latitude><address><![CDATA[Jump Street]]></address><pictures><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1486/4901/1486.jpg?1444841730]]></picture_url></picture><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1486/4903/1486.jpg?1444841730]]></picture_url></picture><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1486/4905/1486.jpg?1444841730]]></picture_url></picture></pictures><date><![CDATA[02/02/2017]]></date><time><![CDATA[22:13]]></time></post><post><property_type><![CDATA[Departamento]]></property_type><id><![CDATA[1486r]]></id><url><![CDATA[https://www.stagingeb.com/mx/inmueble/1486-departamento-en-cuauhtemoc-condesa?utm_source=Trovit]]></url><title><![CDATA[Departamento con Aloja 4, 1 baño en Condesa, Cuauhtémoc, Ciudad de México, México]]></title><content><![CDATA[EasyBroker ID: 1486. Departamento en México, Cuauhtemoc, Condesa. It's a long term l.]]></content><type><![CDATA[For rent]]></type><agency><![CDATA[Real Estate Rockstars]]></agency><price currency='MXN'><![CDATA[5000.0]]></price><floor_area unit='meters'><![CDATA[3]]></floor_area><plot_area unit='meters'><![CDATA[40000]]></plot_area><bathrooms><![CDATA[1]]></bathrooms><city><![CDATA[Cuauhtémoc]]></city><city_area><![CDATA[Condesa]]></city_area><region><![CDATA[Ciudad de México]]></region><longitude><![CDATA[-99.1840123]]></longitude><latitude><![CDATA[19.3875393]]></latitude><address><![CDATA[Jump Street]]></address><pictures><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1486/4901/1486.jpg?1444841730]]></picture_url></picture><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1486/4903/1486.jpg?1444841730]]></picture_url></picture><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1486/4905/1486.jpg?1444841730]]></picture_url></picture></pictures><date><![CDATA[02/02/2017]]></date><time><![CDATA[22:13]]></time></post><post><property_type><![CDATA[Departamento]]></property_type><id><![CDATA[1486t]]></id><url><![CDATA[https://www.stagingeb.com/mx/inmueble/1486-departamento-en-cuauhtemoc-condesa?utm_source=Trovit]]></url><title><![CDATA[Departamento con Aloja 4, 1 baño en Condesa, Cuauhtémoc, Ciudad de México, México]]></title><content><![CDATA[EasyBroker ID: 1486. Departamento en México, Cuauhtemoc, Condesa. It's a long term l.]]></content><type><![CDATA[Short term rentals]]></type><agency><![CDATA[Real Estate Rockstars]]></agency><price currency='MXN' period='monthly'><![CDATA[1500]]></price><floor_area unit='meters'><![CDATA[3]]></floor_area><plot_area unit='meters'><![CDATA[40000]]></plot_area><bathrooms><![CDATA[1]]></bathrooms><city><![CDATA[Cuauhtémoc]]></city><city_area><![CDATA[Condesa]]></city_area><region><![CDATA[Ciudad de México]]></region><longitude><![CDATA[-99.1840123]]></longitude><latitude><![CDATA[19.3875393]]></latitude><address><![CDATA[Jump Street]]></address><pictures><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1486/4901/1486.jpg?1444841730]]></picture_url></picture><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1486/4903/1486.jpg?1444841730]]></picture_url></picture><picture><picture_url><![CDATA[http://s3.amazonaws.com/assets.stagingmg.com/property_images/1486/4905/1486.jpg?1444841730]]></picture_url></picture></pictures><date><![CDATA[02/02/2017]]></date><time><![CDATA[22:13]]></time></post></trovit>")
        end

        it "#get_properties_from_trovit with xmlDocWithAdNodes" do
            result = @service.get_properties_from_trovit(@xmlDocWithAdNodes)
            expect(result).not_to be_nil
            expect(result.count).to eq(5)
        end

        it "#get_properties_from_trovit with xmlDocWithoutAdNodes" do
            result = @service.get_properties_from_trovit(@xmlDocWithoutAdNodes)
            expect(result).not_to be_nil
            expect(result.count).to eq(0)
        end

        it "#build_property_list with xmlDocWithAdNodes" do
            trovitAdNodes = @service.get_properties_from_trovit(@xmlDocWithAdNodes)
            result = @service.build_property_list(trovitAdNodes)
            expect(result).not_to be_nil
            expect(result.count).to eq(5)
            expect(result.first.item_id).to eq("1483s")
        end

        it "#build_property_list with xmlDocWithoutAdNodes" do
            notTrovitAdNodes = @service.get_properties_from_trovit(@xmlDocWithoutAdNodes)
            result = @service.build_property_list(notTrovitAdNodes)
            expect(result).not_to be_nil
            expect(result.count).to eq(0)
        end

        it "#get_property_field wiht xmlDocWithAdNodes and valid fieldName (price)" do
            trovitAdNodes = @service.get_properties_from_trovit(@xmlDocWithAdNodes)
            result = @service.get_property_field(trovitAdNodes.first,"price")
            expect(result).not_to be_nil
            expect(result).to eq("5990000.0")
        end

        it "#get_property_field wiht xmlDocWithAdNodes and not valid fieldName (amount)" do
            trovitAdNodes = @service.get_properties_from_trovit(@xmlDocWithAdNodes)
            result = @service.get_property_field(trovitAdNodes.first,"amount")
            expect(result).not_to be_nil
            expect(result).to eq("")
        end

        it "#get_property_field_attribute wiht xmlDocWithAdNodes and valid fieldName (price) and attribute (currency)" do
            trovitAdNodes = @service.get_properties_from_trovit(@xmlDocWithAdNodes)
            result = @service.get_property_field_attribute(trovitAdNodes.first,"price","currency")
            expect(result).not_to be_nil
            expect(result).to eq("USD")
        end

        it "#get_property_field_attribute wiht xmlDocWithAdNodes and not valid fieldName (amount) and valid attribute (currency)" do
            trovitAdNodes = @service.get_properties_from_trovit(@xmlDocWithAdNodes)
            result = @service.get_property_field_attribute(trovitAdNodes.first,"amount","currency")
            expect(result).not_to be_nil
            expect(result).to eq("")
        end

        it "#get_property_field_attribute wiht xmlDocWithAdNodes and valid fieldName (price) and not valir attribute (country)" do
            trovitAdNodes = @service.get_properties_from_trovit(@xmlDocWithAdNodes)
            result = @service.get_property_field_attribute(trovitAdNodes.first,"price","country")
            expect(result).not_to be_nil
            expect(result).to eq("")
        end

        it "#get_attributes_list wiht xmlDocWithAdNodes" do
            trovitAdNodes = @service.get_properties_from_trovit(@xmlDocWithAdNodes)
            result = @service.get_attributes_list(trovitAdNodes.first)
            expect(result).not_to be_nil
            expect(result.count).to eq(3)
        end   

        it "#get_attributes_list wiht xmlDocWihtAdNodeWithFirsNodeWithoutPicturesAndAttributes" do
            trovitAdNodes = @service.get_properties_from_trovit(@xmlDocWihtAdNodeWithFirsNodeWithoutPicturesAndAttributes)
            result = @service.get_attributes_list(trovitAdNodes.first)
            expect(result).not_to be_nil
            expect(result.count).to eq(0)
        end    

        it "#get_picture_list wiht xmlDocWithAdNodes" do
            trovitAdNodes = @service.get_properties_from_trovit(@xmlDocWithAdNodes)
            result = @service.get_picture_list(trovitAdNodes.first)
            expect(result).not_to be_nil
            expect(result.count).to eq(3)
        end   

        it "#get_picture_list wiht xmlDocWihtAdNodeWithFirsNodeWithoutPicturesAndAttributes" do
            trovitAdNodes = @service.get_properties_from_trovit(@xmlDocWihtAdNodeWithFirsNodeWithoutPicturesAndAttributes)
            result = @service.get_picture_list(trovitAdNodes.first)
            expect(result).not_to be_nil
            expect(result.count).to eq(0)
        end  
    end

end